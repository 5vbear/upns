<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:util="http://www.springframework.org/schema/util"
	xmlns:cache="http://www.springframework.org/schema/cache" xmlns:p="http://www.springframework.org/schema/p" xmlns:c="http://www.springframework.org/schema/c"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd
		http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache-3.2.xsd"
	default-lazy-init="true" default-autowire="no">

	<!-- ehcache -->
	<bean id="ctu.upns.cacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">
		<property name="configLocation" value="classpath:ehcache.xml" />
		<property name="shared" value="true" />
	</bean>

	<bean id="ctu.upns.ehCacheService" class="com.myctu.platform.gateway.agent.cache.ehcache.EhCacheServiceFactoryBean">
        <!-- 与ehcache.xml中的cache name相匹配-->
		<property name="cacheName" value="ctu.upns.local.cache" />
		<property name="cacheManager" ref="ctu.upns.cacheManager" />
	</bean>

	<!-- redis -->
	<bean id="ctu.upns.redisCacheService" class="com.myctu.platform.gateway.agent.cache.redis.RedisCacheServiceFactoryBean">
		<property name="cacheName" value="ctu.upns.remote.cache" />
		<property name="invoker" value="2" />
		<property name="provider" value="5" />
		<property name="gateway_uri" value="${ctu.gateway.uri}" />
		<property name="default_host" value="${ctu.cache.reids.default.host}" />
		<property name="default_port" value="${ctu.cache.reids.default.port}" />
		<property name="default_dbindex" value="${ctu.cache.reids.default.db}" />
	</bean>

	<!-- facade -->
	<bean id="ctu.upns.cacheService" class="com.telecom.ctu.platform.common.cache.DelegateCacheService">
        <!--本地内存cache，由存储标示决定是否调用-->
		<property name="localCacheService" ref="ctu.upns.ehCacheService" />
        <!--远程Redis cache，由存储标示决定是否调用-->
		<property name="remoteCacheService" ref="ctu.upns.redisCacheService" />
        <!--是否启用本地内存cache标示-->
		<property name="useLocal" value="${ctu.cache.useLocal}" />
        <!--是否启用远程Redis cache标示-->
		<property name="useRemote" value="${ctu.cache.useRemote}" />
	</bean>

	<!-- 启用spring注解cacheable -->
	<bean id="ctu.upns.method.cache.cacheManager" class="com.telecom.ctu.platform.common.cache.CTUCacheManager">
		<property name="cacheService">
			<bean class="com.myctu.platform.gateway.agent.cache.ehcache.EhCacheServiceFactoryBean">
				<property name="cacheName" value="ctu.upns.method.cache" />
				<property name="cacheManager" ref="ctu.upns.cacheManager" />
			</bean>
		</property>
	</bean>

	<bean id="ctu.upns.method.cache.keyGenerator" class="com.telecom.ctu.platform.common.cache.CTUCacheKeyGenerator" />

	<cache:annotation-driven proxy-target-class="true" cache-manager="ctu.upns.method.cache.cacheManager"
		key-generator="ctu.upns.method.cache.keyGenerator" />

</beans>